# IS BUILD FILES - AGENTS.md

<!-- Parent: ../AGENTS.md -->

**Generated:** 2026-02-23

---

## Purpose

This directory contains the **build output and packaging artifacts** for Inner Sanctum. These files are generated by the VMU Pro packer tool and represent the distributable game package ready for deployment to the VMU Pro device.

**Key Characteristics:**
- **Build Output:** Contains the assembled .vmupack file ready for device deployment
- **Self-Contained:** All required game resources are included (code, sprites, sounds)
- **Mirror Structure:** Directory layout mirrors the expected runtime structure on the VMU Pro

---

## Files

| File | Purpose | Size |
|------|---------|------|
| `app.lua` | Boot wrapper - imports `app_full.lua` with error handling and logging | ~0.5KB |
| `app_full.lua` | Complete game code (copied from project root) | ~180KB |
| `metadata.json` | Full VMU Pro package manifest with all 116 resources listed | ~4.5KB |
| `metadata_level1.json` | Level 1 specific package metadata | ~2.3KB |
| `metadata_level2.json` | Level 2 specific package metadata | ~2.5KB |
| `innersantctum.vmupack` | Final assembled game package | ~2.2MB |

---

## Subdirectories

| Directory | Purpose |
|-----------|---------|
| `api/` | API modules (text rendering utilities) |
| `sounds/` | All game audio files (WAV format) |
| `sprites/` | All game sprites organized by level and type |

### api/ Contents

| File | Purpose |
|------|---------|
| `text.lua` | Text rendering utilities for VMU Pro display |

### sounds/ Contents

| File | Purpose |
|------|---------|
| `Intro_45sec.wav` | Intro music loop (45 seconds) |
| `inner_sanctum_44k1_adpcm_stereo.wav` | Main game music |
| `intro_source.wav` | Source audio for intro (~8.6MB) |
| `grunt.wav` | Enemy grunt sound effect |
| `grunt (2).wav` | Alternative grunt sound |
| `arg_death1.wav` | Death sound effect |
| `sword_swing_connect.wav` | Sword hit sound |
| `sword_miss.wav` | Sword miss sound |
| `sword_swoosh.wav` | Sword swing whoosh |
| `yah.wav` | Player attack shout |
| `win_level.wav` | Level victory sound |

### sprites/ Contents

| Directory | Contents |
|-----------|----------|
| `level1/` | Level 1 warrior sprites (walk, attack, death animations) + sword + potion |
| `level2/` | Level 2 warrior sprites (walk, attack, death animations) + sword + potion |
| `test/` | Test/development sprites (legacy BMP files) |
| `wall_textures/` | Wall texture files (imported but may not be in build) |

**Per-Level Sprite Sets (~50 files each):**
- `warrior_front/back/left/right.png` - Idle poses (4 directions)
- `warrior_walk1/2/3*.png` - Walking animations (4 directions, 3 frames)
- `warrior_attack_*1/*2.png` - Attack animations (4 directions, 2 frames)
- `warrior_death1-7.png` - Death animation (7 frames)
- `sword_attack1-9.png` - Sword swing effects (9 frames)
- `potion.png` - Health pickup item
- `title.png` - Title screen graphic

---

## For AI Agents

### Build Process

1. **Source:** Files are copied from the main project directory
2. **Packaging:** The packer.py tool reads `metadata.json` and bundles all listed resources
3. **Output:** `innersantctum.vmupack` file is created

### metadata.json Structure

```json
{
  "metadata_version": 1,
  "app_name": "Inner Sanctum",
  "app_author": "VMU Pro Dev",
  "app_version": "0.0.1",
  "app_entry_point": "app.lua",
  "app_mode": 1,
  "app_environment": "lua",
  "icon_transparency": false,
  "resources": ["app.lua", "app_full.lua", ...]
}
```

**Important Fields:**
- `app_entry_point`: Must be `app.lua` (the thin wrapper)
- `resources`: Array of ALL files to include in the package
- Resource paths are relative to this build directory

### Boot Sequence

```
1. VMU Pro loads app.lua
2. app.lua imports api/system
3. app.lua calls pcall(import "app_full")
4. app_full.lua runs AppMain()
5. Game loop begins
```

### Adding New Resources

1. Place the file in the appropriate subdirectory (`sprites/`, `sounds/`, `api/`)
2. Add the relative path to `metadata.json` `resources` array
3. Re-run packer.py to regenerate the .vmupack file

### Size Considerations

- **Total package:** ~2.2MB
- **Sound files:** Majority of the size (especially `intro_source.wav` at 8.6MB - consider removing source files from build)
- **Sprites:** ~100 PNG files, relatively small
- **Code:** ~180KB for `app_full.lua`

### Cleanup Opportunities

The following files may be unnecessary in the build output:
- `intro_source.wav` (8.6MB source file - use compressed version instead)
- `grunt (2).wav` (duplicate/alternate)
- `sprites/test/mask_guy_idle_old.bmp` (legacy test file)

---

## Dependencies

### Build Dependencies
- Files must be present in this directory before running packer
- All resource paths in metadata.json must be valid

### Runtime Dependencies
- None - this is a self-contained package

---

## See Also

- `../AGENTS.md` - Main project documentation
- `../metadata.json` - Source metadata (may differ from build copy)
- `../tools/packer/packer.py` - Tool that generates .vmupack from this directory
