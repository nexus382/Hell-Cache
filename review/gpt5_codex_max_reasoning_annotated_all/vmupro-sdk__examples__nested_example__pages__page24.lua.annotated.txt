00001 [GPT-5-CODEX-MAX-REASONING] -- pages/page24.lua
00002 [GPT-5-CODEX-MAX-REASONING] -- Test Page 24: Sprite Z-Index (setZIndex, getZIndex)
00003 [GPT-5-CODEX-MAX-REASONING] 
00004 [GPT-5-CODEX-MAX-REASONING] Page24 = {}
00005 [GPT-5-CODEX-MAX-REASONING] 
00006 [GPT-5-CODEX-MAX-REASONING] -- Track double buffer state
00007 [GPT-5-CODEX-MAX-REASONING] local db_running = false
00008 [GPT-5-CODEX-MAX-REASONING] 
00009 [GPT-5-CODEX-MAX-REASONING] -- Sprite handles
00010 [GPT-5-CODEX-MAX-REASONING] local sprite1_handle = nil
00011 [GPT-5-CODEX-MAX-REASONING] local sprite2_handle = nil
00012 [GPT-5-CODEX-MAX-REASONING] local sprite3_handle = nil
00013 [GPT-5-CODEX-MAX-REASONING] local sprites_loaded = false
00014 [GPT-5-CODEX-MAX-REASONING] local load_error = false
00015 [GPT-5-CODEX-MAX-REASONING] 
00016 [GPT-5-CODEX-MAX-REASONING] -- Z-index cycling
00017 [GPT-5-CODEX-MAX-REASONING] local cycle_interval = 1000000 -- 1 second
00018 [GPT-5-CODEX-MAX-REASONING] local last_cycle_time = 0
00019 [GPT-5-CODEX-MAX-REASONING] local cycle_state = 0          -- 0-5 for different Z-index arrangements
00020 [GPT-5-CODEX-MAX-REASONING] 
00021 [GPT-5-CODEX-MAX-REASONING] -- Z-index configurations (6 permutations of 3 sprites)
00022 [GPT-5-CODEX-MAX-REASONING] local z_configs = {
00023 [GPT-5-CODEX-MAX-REASONING]     { 1, 2, 3 }, -- S1=1, S2=2, S3=3 (S1 back, S3 front)
00024 [GPT-5-CODEX-MAX-REASONING]     { 1, 3, 2 }, -- S1=1, S3=2, S2=3 (S1 back, S2 front)
00025 [GPT-5-CODEX-MAX-REASONING]     { 2, 1, 3 }, -- S2=1, S1=2, S3=3 (S2 back, S3 front)
00026 [GPT-5-CODEX-MAX-REASONING]     { 2, 3, 1 }, -- S3=1, S1=2, S2=3 (S3 back, S2 front)
00027 [GPT-5-CODEX-MAX-REASONING]     { 3, 1, 2 }, -- S2=1, S3=2, S1=3 (S2 back, S1 front)
00028 [GPT-5-CODEX-MAX-REASONING]     { 3, 2, 1 } -- S3=1, S2=2, S1=3 (S3 back, S1 front)
00029 [GPT-5-CODEX-MAX-REASONING] }
00030 [GPT-5-CODEX-MAX-REASONING] 
00031 [GPT-5-CODEX-MAX-REASONING] --- @brief Load sprites
00032 [GPT-5-CODEX-MAX-REASONING] local function loadSprites()
00033 [GPT-5-CODEX-MAX-REASONING]     if sprites_loaded or load_error then
00034 [GPT-5-CODEX-MAX-REASONING]         return
00035 [GPT-5-CODEX-MAX-REASONING]     end
00036 [GPT-5-CODEX-MAX-REASONING] 
00037 [GPT-5-CODEX-MAX-REASONING]     sprite1_handle = vmupro.sprite.new("assets/mask_guy_idle")
00038 [GPT-5-CODEX-MAX-REASONING]     sprite2_handle = vmupro.sprite.new("assets/mask_guy_idle")
00039 [GPT-5-CODEX-MAX-REASONING]     sprite3_handle = vmupro.sprite.new("assets/mask_guy_idle")
00040 [GPT-5-CODEX-MAX-REASONING] 
00041 [GPT-5-CODEX-MAX-REASONING]     if not sprite1_handle or not sprite2_handle or not sprite3_handle then
00042 [GPT-5-CODEX-MAX-REASONING]         vmupro.system.log(vmupro.system.LOG_ERROR, "Page24", "Failed to load sprites")
00043 [GPT-5-CODEX-MAX-REASONING]         load_error = true
00044 [GPT-5-CODEX-MAX-REASONING]         return
00045 [GPT-5-CODEX-MAX-REASONING]     end
00046 [GPT-5-CODEX-MAX-REASONING] 
00047 [GPT-5-CODEX-MAX-REASONING]     -- Set initial overlapping positions (very close together for maximum overlap)
00048 [GPT-5-CODEX-MAX-REASONING]     vmupro.sprite.setPosition(sprite1_handle, 100, 100)
00049 [GPT-5-CODEX-MAX-REASONING]     vmupro.sprite.setPosition(sprite2_handle, 108, 108)
00050 [GPT-5-CODEX-MAX-REASONING]     vmupro.sprite.setPosition(sprite3_handle, 116, 116)
00051 [GPT-5-CODEX-MAX-REASONING] 
00052 [GPT-5-CODEX-MAX-REASONING]     -- Set initial Z-indices
00053 [GPT-5-CODEX-MAX-REASONING]     vmupro.sprite.setZIndex(sprite1_handle, 1)
00054 [GPT-5-CODEX-MAX-REASONING]     vmupro.sprite.setZIndex(sprite2_handle, 2)
00055 [GPT-5-CODEX-MAX-REASONING]     vmupro.sprite.setZIndex(sprite3_handle, 3)
00056 [GPT-5-CODEX-MAX-REASONING] 
00057 [GPT-5-CODEX-MAX-REASONING]     -- Add sprites to the scene for automatic rendering
00058 [GPT-5-CODEX-MAX-REASONING]     vmupro.sprite.add(sprite1_handle)
00059 [GPT-5-CODEX-MAX-REASONING]     vmupro.sprite.add(sprite2_handle)
00060 [GPT-5-CODEX-MAX-REASONING]     vmupro.sprite.add(sprite3_handle)
00061 [GPT-5-CODEX-MAX-REASONING] 
00062 [GPT-5-CODEX-MAX-REASONING]     sprites_loaded = true
00063 [GPT-5-CODEX-MAX-REASONING]     last_cycle_time = vmupro.system.getTimeUs()
00064 [GPT-5-CODEX-MAX-REASONING]     vmupro.system.log(vmupro.system.LOG_INFO, "Page24", "Sprites loaded and added to scene")
00065 [GPT-5-CODEX-MAX-REASONING] end
00066 [GPT-5-CODEX-MAX-REASONING] 
00067 [GPT-5-CODEX-MAX-REASONING] --- @brief Update logic - cycle through Z-index configurations
00068 [GPT-5-CODEX-MAX-REASONING] function Page24.update()
00069 [GPT-5-CODEX-MAX-REASONING]     if not sprites_loaded then
00070 [GPT-5-CODEX-MAX-REASONING]         return
00071 [GPT-5-CODEX-MAX-REASONING]     end
00072 [GPT-5-CODEX-MAX-REASONING] 
00073 [GPT-5-CODEX-MAX-REASONING]     local current_time = vmupro.system.getTimeUs()
00074 [GPT-5-CODEX-MAX-REASONING] 
00075 [GPT-5-CODEX-MAX-REASONING]     -- Cycle Z-index configuration every second
00076 [GPT-5-CODEX-MAX-REASONING]     if (current_time - last_cycle_time) >= cycle_interval then
00077 [GPT-5-CODEX-MAX-REASONING]         cycle_state = (cycle_state + 1) % 6
00078 [GPT-5-CODEX-MAX-REASONING]         local config = z_configs[cycle_state + 1]
00079 [GPT-5-CODEX-MAX-REASONING] 
00080 [GPT-5-CODEX-MAX-REASONING]         vmupro.sprite.setZIndex(sprite1_handle, config[1])
00081 [GPT-5-CODEX-MAX-REASONING]         vmupro.sprite.setZIndex(sprite2_handle, config[2])
00082 [GPT-5-CODEX-MAX-REASONING]         vmupro.sprite.setZIndex(sprite3_handle, config[3])
00083 [GPT-5-CODEX-MAX-REASONING] 
00084 [GPT-5-CODEX-MAX-REASONING]         last_cycle_time = current_time
00085 [GPT-5-CODEX-MAX-REASONING] 
00086 [GPT-5-CODEX-MAX-REASONING]         vmupro.system.log(vmupro.system.LOG_INFO, "Page24",
00087 [GPT-5-CODEX-MAX-REASONING]             string.format("Z-indices: S1=%d, S2=%d, S3=%d", config[1], config[2], config[3]))
00088 [GPT-5-CODEX-MAX-REASONING]     end
00089 [GPT-5-CODEX-MAX-REASONING] end
00090 [GPT-5-CODEX-MAX-REASONING] 
00091 [GPT-5-CODEX-MAX-REASONING] --- @brief Cleanup when leaving page
00092 [GPT-5-CODEX-MAX-REASONING] function Page24.exit()
00093 [GPT-5-CODEX-MAX-REASONING]     if db_running then
00094 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.stopDoubleBufferRenderer()
00095 [GPT-5-CODEX-MAX-REASONING]         db_running = false
00096 [GPT-5-CODEX-MAX-REASONING]     end
00097 [GPT-5-CODEX-MAX-REASONING] 
00098 [GPT-5-CODEX-MAX-REASONING]     -- Remove all sprites from scene
00099 [GPT-5-CODEX-MAX-REASONING]     vmupro.sprite.removeAll()
00100 [GPT-5-CODEX-MAX-REASONING] 
00101 [GPT-5-CODEX-MAX-REASONING]     -- Free individual sprites
00102 [GPT-5-CODEX-MAX-REASONING]     if sprite1_handle then
00103 [GPT-5-CODEX-MAX-REASONING]         vmupro.sprite.free(sprite1_handle)
00104 [GPT-5-CODEX-MAX-REASONING]         sprite1_handle = nil
00105 [GPT-5-CODEX-MAX-REASONING]     end
00106 [GPT-5-CODEX-MAX-REASONING]     if sprite2_handle then
00107 [GPT-5-CODEX-MAX-REASONING]         vmupro.sprite.free(sprite2_handle)
00108 [GPT-5-CODEX-MAX-REASONING]         sprite2_handle = nil
00109 [GPT-5-CODEX-MAX-REASONING]     end
00110 [GPT-5-CODEX-MAX-REASONING]     if sprite3_handle then
00111 [GPT-5-CODEX-MAX-REASONING]         vmupro.sprite.free(sprite3_handle)
00112 [GPT-5-CODEX-MAX-REASONING]         sprite3_handle = nil
00113 [GPT-5-CODEX-MAX-REASONING]     end
00114 [GPT-5-CODEX-MAX-REASONING]     sprites_loaded = false
00115 [GPT-5-CODEX-MAX-REASONING]     vmupro.system.log(vmupro.system.LOG_INFO, "Page24", "Sprites removed and freed")
00116 [GPT-5-CODEX-MAX-REASONING] end
00117 [GPT-5-CODEX-MAX-REASONING] 
00118 [GPT-5-CODEX-MAX-REASONING] --- @brief Render Page 24: Z-Index Demo
00119 [GPT-5-CODEX-MAX-REASONING] function Page24.render(drawPageCounter)
00120 [GPT-5-CODEX-MAX-REASONING]     -- Start double buffer on first render
00121 [GPT-5-CODEX-MAX-REASONING]     if not db_running then
00122 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.startDoubleBufferRenderer()
00123 [GPT-5-CODEX-MAX-REASONING]         db_running = true
00124 [GPT-5-CODEX-MAX-REASONING]     end
00125 [GPT-5-CODEX-MAX-REASONING] 
00126 [GPT-5-CODEX-MAX-REASONING]     -- Clear screen
00127 [GPT-5-CODEX-MAX-REASONING]     vmupro.graphics.clear(vmupro.graphics.BLACK)
00128 [GPT-5-CODEX-MAX-REASONING] 
00129 [GPT-5-CODEX-MAX-REASONING]     -- Page title
00130 [GPT-5-CODEX-MAX-REASONING]     vmupro.text.setFont(vmupro.text.FONT_GABARITO_18x18)
00131 [GPT-5-CODEX-MAX-REASONING]     vmupro.graphics.drawText("Z-Index", 10, 10, vmupro.graphics.WHITE, vmupro.graphics.BLACK)
00132 [GPT-5-CODEX-MAX-REASONING] 
00133 [GPT-5-CODEX-MAX-REASONING]     vmupro.text.setFont(vmupro.text.FONT_SMALL)
00134 [GPT-5-CODEX-MAX-REASONING] 
00135 [GPT-5-CODEX-MAX-REASONING]     -- Load sprites on first render
00136 [GPT-5-CODEX-MAX-REASONING]     loadSprites()
00137 [GPT-5-CODEX-MAX-REASONING] 
00138 [GPT-5-CODEX-MAX-REASONING]     if load_error then
00139 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.drawText("ERROR: Failed to load", 10, 60, vmupro.graphics.RED, vmupro.graphics.BLACK)
00140 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.drawText("sprites. Check assets.", 10, 75, vmupro.graphics.RED, vmupro.graphics.BLACK)
00141 [GPT-5-CODEX-MAX-REASONING]     elseif not sprites_loaded then
00142 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.drawText("Loading sprites...", 10, 60, vmupro.graphics.YELLOW, vmupro.graphics.BLACK)
00143 [GPT-5-CODEX-MAX-REASONING]     elseif sprite1_handle and sprite2_handle and sprite3_handle then
00144 [GPT-5-CODEX-MAX-REASONING]         -- Draw all sprites in the scene sorted by Z-index
00145 [GPT-5-CODEX-MAX-REASONING]         vmupro.sprite.drawAll()
00146 [GPT-5-CODEX-MAX-REASONING] 
00147 [GPT-5-CODEX-MAX-REASONING]         -- Get and display Z-indices
00148 [GPT-5-CODEX-MAX-REASONING]         local z1 = vmupro.sprite.getZIndex(sprite1_handle)
00149 [GPT-5-CODEX-MAX-REASONING]         local z2 = vmupro.sprite.getZIndex(sprite2_handle)
00150 [GPT-5-CODEX-MAX-REASONING]         local z3 = vmupro.sprite.getZIndex(sprite3_handle)
00151 [GPT-5-CODEX-MAX-REASONING] 
00152 [GPT-5-CODEX-MAX-REASONING]         -- Display Z-index values below sprites
00153 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.drawText("Sprite 1 Z=" .. z1, 10, 170, vmupro.graphics.WHITE, vmupro.graphics.BLACK)
00154 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.drawText("Sprite 2 Z=" .. z2, 10, 185, vmupro.graphics.WHITE, vmupro.graphics.BLACK)
00155 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.drawText("Sprite 3 Z=" .. z3, 10, 200, vmupro.graphics.WHITE, vmupro.graphics.BLACK)
00156 [GPT-5-CODEX-MAX-REASONING] 
00157 [GPT-5-CODEX-MAX-REASONING]         -- Info text
00158 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.drawText("3 overlapping sprites", 110, 170, vmupro.graphics.GREY, vmupro.graphics.BLACK)
00159 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.drawText("Auto-cycling Z-order", 110, 185, vmupro.graphics.GREY, vmupro.graphics.BLACK)
00160 [GPT-5-CODEX-MAX-REASONING]         vmupro.graphics.drawText("Lower Z = Back", 110, 200, vmupro.graphics.GREY, vmupro.graphics.BLACK)
00161 [GPT-5-CODEX-MAX-REASONING]     end
00162 [GPT-5-CODEX-MAX-REASONING] 
00163 [GPT-5-CODEX-MAX-REASONING]     -- Description at top
00164 [GPT-5-CODEX-MAX-REASONING]     vmupro.graphics.drawText("Drawing order control", 10, 40, vmupro.graphics.GREY, vmupro.graphics.BLACK)
00165 [GPT-5-CODEX-MAX-REASONING] 
00166 [GPT-5-CODEX-MAX-REASONING]     -- Navigation hint
00167 [GPT-5-CODEX-MAX-REASONING]     vmupro.graphics.drawText("< Prev | Next >", 75, 225, vmupro.graphics.GREY, vmupro.graphics.BLACK)
00168 [GPT-5-CODEX-MAX-REASONING] 
00169 [GPT-5-CODEX-MAX-REASONING]     -- Page counter
00170 [GPT-5-CODEX-MAX-REASONING]     drawPageCounter()
00171 [GPT-5-CODEX-MAX-REASONING] end
